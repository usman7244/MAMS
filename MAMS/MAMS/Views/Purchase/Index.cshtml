@model List<MAMS_Models.Model.Purchase>
@{
    ViewData["Title"] = "Purchase";
}

<script src="~/js/ToolTip.js"></script>

<!-- #region  Customer List  -->
<div id="divDetails" class="col-md-12 col-sm-12">
    <div class="card ">
        <div class="card-header card-header-primary">
            <h5 class="card-title">
                <i class="fas fa-tasks"></i> Purchased Crops
            </h5>
        </div>
        <div class="card-body">
            
            <a asp-action="PurchaseCrop" asp-controller="Purchase" class="btn btn-success btn-circle" style="margin-left: 10px;  font-size: 11px"> <i class="fa fa-plus-circle" style="vertical-align: middle;"></i> Add Purchase Crop</a>
            <div class="table-responsive">
                <table class="table" id="tblDetailList">
                    <thead class=" text-primary">
                        <tr>
                            <th width="3%" tabindex="0" class="bold" aria-controls="tblDetailList" rowspan="1"
                                colspan="1">
                                # &nbsp;
                            </th>
                            <th width="12%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                Customer Name
                            </th>
                            <th width="8%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                Crop Name
                            </th>
                            <th width="7%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                Weight
                            </th>
                            <th width="7%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                Price
                            </th>
                            <th width="8%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                Expense
                            </th>
                            <th width="13%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                Price With Exp
                            </th>
                            <th width="10%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                Date
                            </th>
                            <th width="10%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                User
                            </th>
@*                             <th width="10%" tabindex="0" class="bold"
                                arial-sort="descending" aria-controls="tblDetailList" rowspan="1" colspan="1">
                                Status
                            </th> *@
                            <th width="10%" tabindex="0" class="sorting bold" aria-controls="tblDetailList" rowspan="1" colspan="1"> Actions&nbsp;&nbsp;&nbsp;</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int num = 1;
                        }
                        @foreach (var item in Model)
                        {
                            var v = item;
                            <tr>
                                <td width="3%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@num</td>
                                <td width="10%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1" style="display:none;"> &nbsp;@item.UID</td>
                                <td width="22%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@item.CustomerName</td>
                                <td width="8%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@item.CropName</td>
                                <td width="7%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@item.TotalCropWeight</td>
                                <td width="7%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@item.TotalCropPrice</td>
                                <td width="8%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@item.TotalExp</td>
                                <td width="13%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@item.TotalAmountwithExp</td>
                                <td width="10%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@item.CreatedDate.ToString("dd/M/yyyy")</td>
                                <td width="10%" tabindex="0" class="sorting" aria-controls="tblDetailList" rowspan="1" colspan="1"> &nbsp;@item.UserName</td>
@*                                 @if (item.Status.ToLower() == "purchase")
                                {
                                    <td width="10%" tabindex="0" class="sorting" aria-controls="tblDetailList" style="color: red;" rowspan="1" colspan="1"> &nbsp;@item.Status</td>
                                }
                                else
                                {
                                    <td width="10%" tabindex="0" class="sorting" aria-controls="tblDetailList" style="color: forestgreen;" rowspan="1" colspan="1"> &nbsp;@item.Status</td>
                                } *@

                                <td width="10%" tabindex="0" class="sorting" aria-controls="datatable_orders" rowspan="1" colspan="1">
                                    @if (item.Status.ToLower() == "purchase")
                                    {
                                        <a asp-action="PurchaseCropEdit" asp-controller="Purchase" asp-route-Id="@item.UID" class=" btn btn-circle btn-sm"><i class="fa fa-edit" data-toggle="tooltip" data-placement="bottom" title="Edit Purchase Crop"></i></a>
                                        <a asp-action="StockSale" asp-controller="Sale" asp-route-ID="@item.UID" class="btn btn-circle btn-sm" id="btnStockSale">
                                            <i class="fa fa-mail-forward" data-toggle="tooltip" title="Click here to Sale"></i>
                                        </a>
                                    }

                                    <a class="btn btn-circle btn-sm" name="btnDel" id="@item.UID"><i class="fa fa-trash" data-toggle="tooltip" data-placement="bottom" title="Delete Purchase Crop"></i></a>
                                </td>
                            </tr>
                            num++;
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- #endregion -->
<!-- #region  alert -->
<div id="alertSuccess" data-notify="container" class="col-11 col-md-4 alert alert-success alert-with-icon animated fadeInDown" role="alert" data-notify-position="top-center" style="display: inline-block; margin: 15px auto; position: fixed; transition: all 0.5s ease-in-out 0s; z-index: 1031; top: 20px; left: 0px; right: 0px;">
    <button type="button" aria-hidden="true" class="close" data-notify="dismiss" style="position: absolute; right: 10px; top: 50%; margin-top: -9px; z-index: 1033;">
        <i class="material-icons">close</i>
    </button><i data-notify="icon" class="material-icons">add_alert</i><span data-notify="title"></span> <span data-notify="message"><b>Purchase</b> <br>Purchase Delete successfuly!</span>
    <a href="" target="_blank" data-notify="url"></a>
</div>

<!-- #region Scripts -->
@section Scripts {



}
<!-- #endregion -->
<!-- #region   javascript -->
<script type="text/javascript">
    $("#alertSuccess").hide();
    $("#alertDanger").hide();
    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();
        $("#tblDetailList").on('click', "a[name='btnDel']", function () {

            var uId = $.trim($(this).closest('tr').find("td:eq(1)").text());
            $.confirm({

                theme: 'modern',
                title: 'DELETE!',
                content: 'Are you sure you want to delete?',
                type: 'green',
                typeAnimated: true,
                buttons:
                {
                    tryAgain:
                    {
                        text: 'No',
                        btnClass: 'btn-green',
                    },
                    warning:
                    {
                        text: 'Yes',
                        btnClass: 'btn-blue',
                        action: function () {

                            $.ajax({

                                type: "post",
                                url: "/Purchase/DeletePurchaseCrop",
                                data: { purchCropId: uId },
                                success: function (data) {
                                    $("#alertSuccess").show();
                                    console.log(data);

                                  
                                    setTimeout(function () {
                                        window.location.href = '/Purchase/Index';
                                    }, 2000);
                                }
                            });
                        }
                    }
                }
            });
        });
    });


    //Sale button

    $(document).ready(function () {
      
        $('[data-toggle="tooltip"]').tooltip();

      
        $("#tblDetailList").on('click', "#btnStockSale", function (e) {
            e.preventDefault();

            var uId = $.trim($(this).closest('tr').find("td:eq(1)").text());

            $.confirm({
                theme: 'modern',
                title: 'SALE!',
                content: 'Are you sure you want to proceed with the sale?',
                type: 'green',
                typeAnimated: true,
                buttons: {
                    cancel: {
                        text: 'No',
                        btnClass: 'btn-green',
                    },
                    confirm: {
                        text: 'Yes',
                        btnClass: 'btn-blue',
                        action: function () {
                            debugger;
                            $.ajax({
                                type: "POST",
                                url: "",
                                data: { Id: uId },
                                success: function (data) {
                                    console.log(data);
                                    setTimeout(function () {
                                        window.location.href = '/Sale/StockSale/' + uId;
                                    }, 2000);
                                }
                            });
                        }
                    }
                }
            });
        });
    });


</script>
<!-- #endregion -->
<!-- #region Style -->
<style>
    a.btn.btn-circle.btn-sm {
        border: 0px;
        background-color: rgb(204 204 204 / 15%);
        font-size: 10px;
        color: darkgreen;
        padding: 5px
    }

    .table-responsive {
        height: 600px;
    }
</style>
<!-- #endregion -->
