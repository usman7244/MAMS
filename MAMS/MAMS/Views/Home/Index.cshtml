@model List<MAMS_Models.Model.CashHistory>
  
@{
    ViewData["Title"] = "Graph";
    var profitList = Model;
     
 
}

<link href="~/lib/flatpickr/flatpickr.css" rel="stylesheet" />
<script src="~/lib/flatpickr/flatpickr.js"></script>

<!-- #region Select start and end date -->
<div class="card">
    <div class="card-header card-header-primary">
        <i class="material-icons">search</i>
        <h5 class="card-title"> Search</h5>
    </div>
    <div class="card-body">
        <form id="DepositForm" enctype="multipart/form-data" action="/Home/Index" method="Put">
            <div class="row">
                <div class="col-md-3 col-sm-3">
                    <div class="form-group">
                        <label class="control-label bold"  >Start Date</label>
                        <input type="text" name="FromDate" id="FromDate" class="form-control form-control-inline date-picker"
                         value="" title="Enter From Date" />
                    </div>
                </div>
                <div class="col-md-3 col-sm-3">
                    <div class="form-group">
                        <label class="control-label bold"  id="lblToDate">End Date</label>
                        <input type="text" id="ToDate" name="ToDate" class="form-control form-control-inline date-picker"
                               value="" title="Enter To Date" />
                    </div>
                </div>
                <div class="col-md-4 col-sm-4">
                    <button type="submit" id="Searchbtn"  class="btn btn-primary pull-left">Search</button>
                    <div class="clearfix"></div>
                </div>
            </div>
        </form>
    </div>
</div>



<!-- #endregion -->
<!-- #region  date selection Graph  -->
<div class="row" style=" margin-bottom: 10%;">
    <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="card ">
            <div class="card-header card-header-primary">
                <i class="material-icons">signal_cellular_alt</i>
                <h5 class="card-title">Profit/Loss in Graph</h5>
                @*<p class="card-category">Complete your profile</p>*@
            </div>
            <div class="card-body">
                <div class="table-responsive" style="height:480px; overflow:hidden; ">
                    <div class="row">
                        <div class="col-md-12">
                            <!-- BEGIN CHART PORTLET-->
                            <div class="portlet light bordered">
                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class="icon-bar-chart font-green-haze"></i>
                                    </div>
                                    <div class="tools">
                                        <a href="javascript:;" class="reload"> </a>
                                    </div>
                                </div>
                                <div class="portlet-body">
                                    <div id="chartContainer" style="height: 480px; width: 100%;"></div>
                                </div>
                            </div>
                            <!-- END CHART PORTLET-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- #endregion -->
<!-- #region Links JavaScript Section -->
@section Scripts {
    <script src="~/js/canvas.min.js"></script>
}
<!-- #endregion -->
<!-- #region JQuery Methods -->
<script type="text/javascript">
   
    window.onload = function () {
         var profitArray = @Html.Raw(Json.Serialize(profitList));
         var cars = [];
         profitArray.forEach(function (item) {
            
            var cashProfit = parseFloat(item.cashProfit);  
            var cashLost = parseFloat(item.cashLost);       
            var createdDate = new Date(item.createdDate);  
            var formattedDate = createdDate.toLocaleDateString('en-PK', {
                day: '2-digit',
                month: '2-digit',
                year: '2-digit'
            });
            if (cashProfit > 0) {
                cars.push({ label: formattedDate, y: cashProfit, color: "green", toolTipContent: "Profit {label}: <br>{y}", });
            } 
            else {
                cars.push({ label: formattedDate, y: cashLost, color: "red", toolTipContent: "Loss {label}: <br>{y}", });
            }

            if (cashLost < 0) {
                cars.push({ label: formattedDate, y: cashLost, color: "red", toolTipContent: "Loss {label}: <br>{y}", });
            }
        });
          var options = {
            animationEnabled: true,
            title: {
                text: "Profit/Loss Percent by Month",
                fontSize: 25,
            },
            axisY: {
                title: "Green is Profit And Red is Loss",
                suffix: ""
            },
            axisX: {
                interval: 1,
                title: "DATE",
            },
            dataPointWidth: 80,
            data: [{
                type: "column",
                yValueFormatString: "#,##0.0#",
                indexLabel: "{y}",
                indexLabelPlacement: "outside",
                indexLabelFontColor: "black",
                indexLabelFontSize: 15,
                indexLabelFontWeight: "bold",
               // toolTipContent: "Profit {label}: <br>{y}",
                dataPoints: cars
            }]
        };

        $("#chartContainer").CanvasJSChart(options);
    }
 
    var today = new Date();
    var lastMonth = new Date();
    lastMonth.setMonth(lastMonth.getMonth() - 1);

    flatpickr('#FromDate', {
        altInput: true,
        altFormat: "F j, Y",
        dateFormat: "Y-m-d",
        defaultDate: [lastMonth]
    });
    flatpickr('#ToDate', {
        altInput: true,
        altFormat: "F j, Y",
        dateFormat: "Y-m-d",
        defaultDate: "today"
    });

</script>
<!-- #endregion -->

<style>
    .card-header.card-header-primary {
        background: linear-gradient( 60deg, #00acc1, #00acc1) !important;
    }

    i.material-icons {
        float: left;
    }

    a.canvasjs-chart-credit {
        display: none;
    }

    .portlet > .portlet-title > .caption > .caption-helper {
        font-size: 16px !important;
    }
    /* .card-icon {
            height: 66px;
            width: 71px;
            padding: 6px !important;
        } */
    .card.card-stats {
        margin-top: 0px !important;
    }

    ul.nav.nav-tabs {
        border-bottom: 0px;
    }

    button.btn.btn-primary.pull-left {
        background-color: #088c9c;
        border-color: #00acc1;
    }
</style>